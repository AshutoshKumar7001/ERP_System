{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Purchase Orders</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container">
  <h2>Purchase Orders</h2>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>ID</th>
        <th>Supplier</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for po in purchase_orders %}
      <tr>
        <td>{{ po.id }}</td>
        <td>{{ po.supplier.name }}</td>
        <td>{{ po.status }}</td>
        <td>{{ po.created_at }}</td>
        <td>
          {% if po.status == 'Pending' %}
          <button class="btn btn-success approve-btn" data-id="{{ po.id }}">Approve</button>
          {% endif %}
          {% if po.status == 'Approved' or po.status == 'Partially Delivered' %}
          <button class="btn btn-primary receive-btn" data-id="{{ po.id }}">Receive Goods</button>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
const csrftoken = getCookie('csrftoken');

// Approve button click
$('.approve-btn').click(function(){
    const id = $(this).data('id');
    $.ajax({
        url: `/api/purchase-orders/${id}/approve/`,
        type: 'POST',
        headers: { 'X-CSRFToken': csrftoken },
        success: function(response) {
            location.reload();
        },
        error: function(xhr) {
            alert('Error: ' + xhr.responseText);
        }
    });
});

// Receive Goods button click (dummy implementation)
$('.receive-btn').click(function(){
    const id = $(this).data('id');
    $.ajax({
        url: `/api/purchase-orders/${id}/receive/`,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({"items":[]}), // You can customize received items here
        headers: { 'X-CSRFToken': csrftoken },
        success: function(response) {
            location.reload();
        },
        error: function(xhr) {
            alert('Error: ' + xhr.responseText);
        }
    });
});
</script>
</body>
</html>
